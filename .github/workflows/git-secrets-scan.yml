name: Git Secrets Scan

permissions:
    contents: read

on:
    push:
        branches:
            - main
            - release-*
            - v*
    workflow_dispatch:

concurrency:
    group: git-secrets-scan-${{ github.head_ref || github.ref }}
    cancel-in-progress: true

jobs:
    scan:
        runs-on: ubuntu-latest
        timeout-minutes: 10

        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Install git-secrets
              run: |
                  git clone --depth 1 --branch 1.3.0 https://github.com/awslabs/git-secrets.git
                  cd git-secrets
                  sudo make install

            - name: Configure git-secrets
              run: git secrets --register-aws

            - name: Run git-secrets
              run: git secrets --scan
