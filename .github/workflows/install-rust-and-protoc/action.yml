name: Install Rust tool chain and protoc

inputs:
    target:
        description: "Specified target for rust toolchain, ex. x86_64-apple-darwin"
        type: string
        required: false
        default: "x86_64-unknown-linux-gnu"
        options:
            - x86_64-unknown-linux-gnu
            - aarch64-unknown-linux-gnu
            - x86_64-apple-darwin
            - aarch64-apple-darwin
            - x86_64-pc-windows-msvc
    github-token:
        description: "GitHub token"
        type: string
        required: true

runs:
    using: "composite"
    steps:
        - name: Cache Rust toolchain
          uses: actions/cache@v4
          id: cache-rust
          with:
              path: |
                  ~/.rustup
                  ~/.cargo/bin
                  ~/.cargo/registry/index
                  ~/.cargo/registry/cache
                  ~/.cargo/git
              key: rust-${{ inputs.target }}-${{ runner.os }}-v1
              restore-keys: |
                  rust-${{ inputs.target }}-${{ runner.os }}-

        - name: Install Rust toolchain
          uses: dtolnay/rust-toolchain@stable
          with:
              targets: ${{ inputs.target }}
              components: rustfmt, clippy

        - name: Install protoc (protobuf)
          uses: ./.github/workflows/install-protoc-cached
          with:
              version: "25.1"
